<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Consultar Contatos - Agenda Telefônica Pública">
    <title>Consultar telefones</title>
</head>
<body>
<header>
    <h1>Consultar telefones</h1>
</header>
<main>
    <table id="contactsTable">
        <thead>
        <tr>
            <th>Nome</th>
            <th>Telefones</th>
            <th>Opções</th>
        </tr>
        </thead>
        <tbody>
        <!-- Linhas que serão preenchidas dinamicamente -->
        </tbody>
    </table>
</main>
<footer>
    <p>Feito por Bárbara Branco e Lucas Cruz</p>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('http://localhost:3000/contacts') // URL do JSON server
            .then(response => response.json())
            .then(data => {
                const tableBody = document.querySelector('#contactsTable tbody');
                tableBody.innerHTML = '';

                data.forEach(contact => {
                    const row = document.createElement('tr');

                    const nameCell = document.createElement('td');
                    nameCell.textContent = contact.name;
                    row.appendChild(nameCell);

                    const phonesCell = document.createElement('td');
                    const phonesList = document.createElement('ul');
                    contact.phones.forEach(phone => {
                        const phoneItem = document.createElement('li');
                        phoneItem.textContent = phone.toString();
                        phonesList.appendChild(phoneItem);
                    });
                    phonesCell.appendChild(phonesList);
                    row.appendChild(phonesCell);

                    const actionsCell = document.createElement('td');

                    // Edit form
                    const editForm = document.createElement('form');
                    editForm.className = 'editForm';

                    const editNameInput = document.createElement('input');
                    editNameInput.type = 'text';
                    editNameInput.value = contact.name;
                    editNameInput.name = 'nome';
                    editForm.appendChild(editNameInput);

                    const editPhoneInput = document.createElement('input');
                    editPhoneInput.type = 'tel';
                    editPhoneInput.value = contact.phones[0];
                    editPhoneInput.name = 'telefone';
                    editForm.appendChild(editPhoneInput);

                    const saveButton = document.createElement('button');
                    saveButton.type = 'submit';
                    saveButton.className = 'button';
                    saveButton.textContent = 'Salvar';
                    editForm.appendChild(saveButton);

                    editForm.addEventListener('submit', function(event) {
                        event.preventDefault();
                        const formData = new FormData(this);
                        const updatedContact = {
                            name: formData.get('nome'),
                            phones: [formData.get('telefone')]
                        };

                        fetch(`http://localhost:3000/contacts/${contact.id}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(updatedContact)
                        })
                            .then(response => {
                                if (response.ok) {
                                    alert('Contato atualizado com sucesso!');
                                    window.location.reload();
                                } else {
                                    alert('Erro ao atualizar contato. Por favor, tente novamente.');
                                }
                            })
                            .catch(error => console.error('Erro: ', error));
                    });

                    actionsCell.appendChild(editForm);

                    // Delete button
                    const deleteButton = document.createElement('button');
                    deleteButton.className = 'button delete';
                    deleteButton.textContent = 'Excluir';
                    deleteButton.addEventListener('click', function() {
                        if (confirm('Tem certeza de que deseja excluir este contato?')) {
                            fetch(`http://localhost:3000/contacts/${contact.id}`, {
                                method: 'DELETE'
                            })
                                .then(response => {
                                    if (response.ok) {
                                        alert('Contato excluído com sucesso!');
                                        window.location.reload();
                                    } else {
                                        alert('Erro ao excluir contato. Por favor, tente novamente.');
                                    }
                                })
                                .catch(error => console.error('Erro: ', error));
                        }
                    });
                    actionsCell.appendChild(deleteButton);

                    row.appendChild(actionsCell);

                    tableBody.appendChild(row);
                });
            })
            .catch(error => console.error('Erro', error));
    });
</script>
</body>
</html>
