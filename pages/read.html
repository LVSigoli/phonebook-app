<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Consultar Contatos - Agenda Telefônica Pública">
    <link rel="stylesheet" href="../style/styles.css">
    <title>Consultar telefones</title>
</head>
<body>
<div class="container">
    <header>
        <p class="titulo">Consultar telefones</p>
    </header>
    <main>
        <table id="contactsTable">
            <thead>
            <tr>
                <th class="titulo-tabela">Nome</th>
                <th class="titulo-tabela">Telefones</th>
                <th class="titulo-tabela-op">Opções</th>
            </tr>
            </thead>
            <tbody>
            <!-- Linhas que serão preenchidas dinamicamente -->
            </tbody>
        </table>
    </main>
    <footer>
        <p>Feito por Bárbara Branco e Lucas Cruz</p>
    </footer>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const contacts = JSON.parse(localStorage.getItem('contacts')) || [];
            const tableBody = document.querySelector('#contactsTable tbody');
            tableBody.innerHTML = '';

            contacts.forEach(contact => {
                const row = document.createElement('tr');

                const nameCell = document.createElement('td');
                nameCell.textContent = contact.name;
                row.appendChild(nameCell);

                const phonesCell = document.createElement('td');
                phonesCell.className = 'td-tel';
                const phonesList = document.createElement('ul');
                contact.phones.forEach(phone => {
                    const phoneItem = document.createElement('li');
                    phoneItem.textContent = phone.toString();
                    phonesList.appendChild(phoneItem);
                });
                phonesCell.appendChild(phonesList);
                row.appendChild(phonesCell);

                const actionsCell = document.createElement('td');
                const actionsContainer = document.createElement('div');
                actionsContainer.className = 'actions-container';

                const editButton = document.createElement('img');
                editButton.src = '../media/botao-editar.png';
                editButton.alt = 'Editar';
                editButton.className = 'button-read';
                editButton.addEventListener('click', function() {
                    if (editButton.getAttribute('data-editing') !== 'true') {
                        makeEditable(row, contact);
                        editButton.setAttribute('data-editing', 'true');
                        editButton.textContent = 'Salvar';
                    } else {
                        saveEdits(row, contact.id, editButton);
                        editButton.setAttribute('data-editing', 'false');
                        editButton.textContent = 'Editar';
                    }
                });
                actionsContainer.appendChild(editButton);

                const deleteButton = document.createElement('img');
                deleteButton.src = '../media/botao-excluir.png';
                deleteButton.alt = 'Excluir';
                deleteButton.className = 'button-read';
                deleteButton.addEventListener('click', function() {
                    if (confirm('Tem certeza de que deseja excluir este contato?')) {
                        const updatedContacts = contacts.filter(c => c.id !== contact.id);
                        localStorage.setItem('contacts', JSON.stringify(updatedContacts));
                        alert('Contato excluído com sucesso!');
                        window.location.reload();
                    }
                });
                actionsContainer.appendChild(deleteButton);

                actionsCell.appendChild(actionsContainer);
                row.appendChild(actionsCell);
                tableBody.appendChild(row);
            });
        });

        function makeEditable(row, contact) {
            const nameCell = row.children[0];
            const phonesCell = row.children[1];

            const nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.value = contact.name;
            nameCell.innerHTML = '';
            nameCell.appendChild(nameInput);

            phonesCell.innerHTML = '';
            contact.phones.forEach(phone => {
                const phoneInput = document.createElement('input');
                phoneInput.type = 'tel';
                phoneInput.value = phone.toString();
                phonesCell.appendChild(phoneInput);
            });
        }

        function saveEdits(row, contactId) {
            const nameInput = row.children[0].querySelector('input');
            const phoneInputs = Array.from(row.children[1].querySelectorAll('input'));

            const updatedContact = {
                id: contactId,
                name: nameInput.value,
                phones: phoneInputs.map(input => input.value)
            };

            const contacts = JSON.parse(localStorage.getItem('contacts')) || [];
            const contactIndex = contacts.findIndex(c => c.id === contactId);
            contacts[contactIndex] = updatedContact;
            localStorage.setItem('contacts', JSON.stringify(contacts));

            alert('Contato atualizado com sucesso!');
            window.location.reload();
        }
    </script>
</div>
</body>
</html>
